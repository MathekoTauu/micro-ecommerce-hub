{% extends "base.html" %}

{% block title %}Vendor Dashboard - ZapMarket{% endblock %}

{% block content %}
<div class="container dashboard-container">
    <div class="dashboard-header">
        <h1>Vendor Dashboard</h1>
        <p>Welcome back, {{ current_user.name }}!</p>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">‚ö°</div>
            <div class="stat-info">
                <h3>{{ "{:,}".format(stats.total_sales) }} sats</h3>
                <p>Total Sales</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üì¶</div>
            <div class="stat-info">
                <h3>{{ stats.total_orders }}</h3>
                <p>Total Orders</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">üõçÔ∏è</div>
            <div class="stat-info">
                <h3>{{ stats.active_products }}</h3>
                <p>Active Products</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-info">
                <h3>{{ vendor.rating }}</h3>
                <p>Rating</p>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="dashboard-actions">
        <a href="{{ url_for('add_product') }}" class="btn btn-primary">
            ‚ûï Add New Product
        </a>
        <a href="{{ url_for('vendor_profile') }}" class="btn btn-secondary">
            üë§ Edit Profile
        </a>
    </div>

    <!-- Products Section -->
    <div class="dashboard-section">
        <h2>Your Products</h2>
        
        {% if products %}
        <div class="products-table">
            <table>
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Category</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>
                            <div class="product-cell">
                                <img src="{{ url_for('static', filename='images/products/' + product.image) }}" 
                                     alt="{{ product.name }}" class="product-thumb">
                                <span>{{ product.name }}</span>
                            </div>
                        </td>
                        <td class="price-cell">{{ "{:,}".format(product.price_sats) }} sats</td>
                        <td>
                            <span class="stock-badge {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                                {{ product.stock }}
                            </span>
                        </td>
                        <td>{{ product.category }}</td>
                        <td>
                            <div class="action-buttons">
                                <a href="{{ url_for('edit_product', product_id=product.id) }}" 
                                   class="btn-icon" title="Edit">‚úèÔ∏è</a>
                                <form method="POST" action="{{ url_for('delete_product', product_id=product.id) }}" 
                                      style="display: inline;" 
                                      onsubmit="return confirm('Are you sure you want to delete this product?');">
                                    <button type="submit" class="btn-icon" title="Delete">üóëÔ∏è</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>You haven't added any products yet.</p>
            <a href="{{ url_for('add_product') }}" class="btn btn-primary">Add Your First Product</a>
        </div>
        {% endif %}
    </div>

    <!-- Recent Orders Section -->
    <div class="dashboard-section">
        <h2>Recent Orders</h2>
        
        {% if orders %}
        <div class="orders-list">
            {% for order in orders[-10:] %}
            <div class="order-card">
                <div class="order-info">
                    <h4>Order #{{ order.payment_hash[:8] }}</h4>
                    <p>{{ order.quantity }} item(s) ‚Ä¢ {{ "{:,}".format(order.amount_sats) }} sats</p>
                    <small>{{ order.created_at }}</small>
                </div>
                <div class="order-status">
                    <span class="status-badge status-{{ order.status }}">
                        {{ order.status }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>No orders yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}