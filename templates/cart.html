{% extends "base.html" %}

{% block title %}Your Cart - ZapMarket{% endblock %}

{% block content %}
<div class="container cart-page-container">
    <h1>üõí Your Cart</h1>

    <div id="cart-page-empty" class="empty-state" style="display:none;">
        <h2>Your cart is empty</h2>
        <p>Browse our products and add items to your cart.</p>
        <a href="/" class="btn btn-primary">Browse Products</a>
    </div>

    <div id="cart-page-content" style="display:none;">
        <div class="cart-page-grid">
            <!-- Cart Items -->
            <div class="cart-items-list" id="cart-page-items"></div>

            <!-- Order Summary Sidebar -->
            <div class="cart-summary">
                <div class="sidebar-card">
                    <h3>Order Summary</h3>
                    <div class="summary-row">
                        <span>Items:</span>
                        <span id="cart-summary-count">0</span>
                    </div>
                    <div class="summary-row summary-total">
                        <strong>Total:</strong>
                        <strong id="cart-summary-total">0 sats</strong>
                    </div>
                    <div class="cart-summary-actions">
                        <button class="btn btn-secondary btn-full" onclick="if(confirm('Clear all items?')) Cart.clear(); renderCartPage();">
                            Clear Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function renderCartPage() {
    const items = Cart.getItems();
    const emptyEl = document.getElementById('cart-page-empty');
    const contentEl = document.getElementById('cart-page-content');
    const itemsEl = document.getElementById('cart-page-items');
    const countEl = document.getElementById('cart-summary-count');
    const totalEl = document.getElementById('cart-summary-total');

    if (items.length === 0) {
        emptyEl.style.display = 'block';
        contentEl.style.display = 'none';
        return;
    }

    emptyEl.style.display = 'none';
    contentEl.style.display = 'block';

    itemsEl.innerHTML = items.map(item => `
        <div class="cart-page-item">
            <img src="/static/images/products/${item.image}" alt="${item.name}" class="cart-page-item-img">
            <div class="cart-page-item-info">
                <h3><a href="/product/${item.id}">${item.name}</a></h3>
                <p class="cart-item-price">${item.price_sats.toLocaleString()} sats each</p>
            </div>
            <div class="cart-page-item-qty">
                <button class="qty-btn" onclick="Cart.updateQuantity('${item.id}', ${item.quantity - 1}); renderCartPage();">‚àí</button>
                <span>${item.quantity}</span>
                <button class="qty-btn" onclick="Cart.updateQuantity('${item.id}', ${item.quantity + 1}); renderCartPage();">+</button>
            </div>
            <div class="cart-page-item-subtotal">
                <strong>${(item.price_sats * item.quantity).toLocaleString()} sats</strong>
            </div>
            <button class="cart-remove-btn" onclick="Cart.removeItem('${item.id}'); renderCartPage();">üóëÔ∏è</button>
        </div>
    `).join('');

    countEl.textContent = Cart.getCount();
    totalEl.textContent = Cart.getTotal().toLocaleString() + ' sats';
}

document.addEventListener('DOMContentLoaded', renderCartPage);
</script>
{% endblock %}
